<!DOCTYPE html>
<html>
  <head>
    <title>Movimenta√ß√µes</title>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }

    .header {
      background-color: #343a40;
      color: white;
      padding: 15px 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-weight: 600;
    }

    /* Espa√ßamento entre os bot√µes */
    .header .btn + .btn {
      margin-left: 12px;
    }

    #resposta {
      margin-top: 15px;
      font-weight: bold;
    }

  </style>
  </head>
  <body>
    <body>
  <!-- Cabe√ßalho -->
  <div class="header d-flex justify-content-between align-items-center">
    <h1 class="h4 m-0">Movimenta√ß√£o</h1>

    <!-- Bot√µes lado a lado √† direita -->
    <div class="d-flex">
      <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Dashboard</a>
      <a href="{{ url_for('homepage') }}" class="btn btn-primary">Homepage</a>
    </div>
  </div>

    <div class="container text-center p-5">
      <h4 class="mb-3 text-primary">Leitura de QR Code</h4>

      <input
        type="text"
        id="qrInput"
        class="form-control form-control-lg"
        placeholder="Aponte o leitor para o QR Code"
        autofocus
        onkeydown="lerQRCode(event)"
      >

      <div class="p-3" id="Observacao">
        <p>Observa√ß√£o: Para lan√ßar manualmente, digite o codigo QR unico e aperte ENTER</p>
      </div>
      
      <!-- Adicionar camera para leitura (Descobri que s√≥ funciona com https) -->
      <!-- <button class="btn btn-success mt-2 w-100" onclick="iniciarCamera()">
        üì∑ Ler QR Code com a c√¢mera
      </button>

      <video id="video" class="mt-3 w-100" style="display:none; border-radius:8px;"></video>
      <canvas id="canvas" style="display:none;"></canvas> -->

      <div id="resposta"></div>

      <a href="{{ url_for('homepage') }}" class="btn btn-secondary mt-4">Voltar √† Home üè†</a>
    </div> 

    <script>
      function processar_dado(qr, id_unico) {
      const resposta = document.getElementById("resposta");

      resposta.innerText = "Processando...";
      resposta.className = "text-warning";

      fetch(`/movimentacao/${qr}/${id_unico}`)
        .then(r => r.text())
        .then(data => {
          resposta.innerText = data;
          resposta.className = "text-success";
        })
        .catch(err => {
          resposta.innerText = "Erro na requisi√ß√£o";
          resposta.className = "text-danger";
          console.error(err);
        });
    }

    function lerQRCode(event) {
      if (event.key !== "Enter") return;

      const input = document.getElementById("qrInput");
      const resposta = document.getElementById("resposta");
      const valor = input.value.trim();

      if (!valor.includes("/")) {
        resposta.innerText = "QR Code inv√°lido";
        resposta.className = "text-danger";
        input.value = "";
        return;
      }

      const [qr, id_unico] = valor.split("/");

      if (!qr || !id_unico) {
        resposta.innerText = "QR Code inv√°lido";
        resposta.className = "text-danger";
        input.value = "";
        return;
      }

      processar_dado(qr, id_unico);
      input.value = "";
    }

    </script>
  </body>
</html>
